<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Specifying Games • RelationalContracts</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Specifying Games">
<meta property="og:description" content="RelationalContracts">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">RelationalContracts</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/index.html">Manuals</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/skranz/RelationalContracts">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="1_Specifying_Games_files/header-attrs-2.5/header-attrs.js"></script><link href="1_Specifying_Games_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="1_Specifying_Games_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Specifying Games</h1>
            
      
      
      <div class="hidden name"><code>1_Specifying_Games.Rmd</code></div>

    </div>

    
    
<p>This vignette illustrates how you can specify dynamic games with the <code>RelationalContracts</code> package. We start with simple examples and move to more complex use cases.</p>
<p>In particular, sections 7-9 give advice on how to effectively specify state transitions for complex game with multidimensional state spaces.</p>
<div id="specifying-a-simple-repeated-game" class="section level2">
<h2 class="hasAnchor">
<a href="#specifying-a-simple-repeated-game" class="anchor"></a>1. Specifying a simple repeated game</h2>
<p>Consider a simple two player repeated game. Each player <span class="math inline">\(i\)</span> chooses an effort level <span class="math inline">\(e_i\)</span> on a grid between 0 and 1 that directly benefits the other player. Effort involves for player <span class="math inline">\(i\)</span> cost of <span class="math inline">\(\frac 1 2 e_i\)</span> and grants the other player a benefit of <span class="math inline">\(e_i\)</span>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw">RelationalContracts</span>)
<span class="kw">effort.seq</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>,<span class="fl">1</span>,by=<span class="fl">0.1</span>)
<span class="kw">g</span> <span class="op">=</span> <span class="fu"><a href="../reference/rel_game.html">rel_game</a></span>(<span class="st">"Mutual Gift Game"</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/rel_states.html">rel_state</a></span>(<span class="st">"x0"</span>,
    <span class="co"># Both players can pick effort</span>
    <span class="co"># on a grid between 0 and 1</span>
    A1 = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(e1=<span class="kw">effort.seq</span>),
    A2 = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(e2=<span class="kw">effort.seq</span>),

    <span class="co"># Stage game payoffs</span>
    pi1 = <span class="kw">e2</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">*</span><span class="kw">e1</span><span class="op">^</span><span class="fl">2</span>,
    pi2 = <span class="kw">e1</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">*</span><span class="kw">e2</span><span class="op">^</span><span class="fl">2</span>
  )

<span class="co"># Solve SPE</span>
<span class="kw">g</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/rel_spe.html">rel_spe</a></span>(delta=<span class="fl">0.3</span>) <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/get_eq.html">get_eq</a></span>() <span class="op">%&gt;%</span> <span class="fu">select</span>(<span class="kw">x</span>, <span class="kw">ae.lab</span>)
</pre></div>
<pre><code>## # A tibble: 1 x 2
##   x     ae.lab   
##   &lt;chr&gt; &lt;chr&gt;    
## 1 x0    0.6 | 0.6</code></pre>
<p>The function <code>rel_game</code> specifies an empty game object and <code>rel_state</code> specifies a state. A repeated game has just a single state, but one can also specify more general <a href="https://en.wikipedia.org/wiki/Stochastic_game">stochastic games</a> with several states.</p>
<p>The parameters <code>A1</code> and <code>A2</code> specify the action spaces of each player. You have to provide a named list of actions for each player, here we have the actions <code>e1</code> for player 1 and <code>e2</code> for player 2. Note that you must choose different names for each player’s actions, i.e. you could not call both actions just <code>e</code>.</p>
<p>The parameters <code>pi1</code> and <code>pi2</code> specify payoffs for both players. Payoffs will be lazily evaluated later on the corresponding action space. This means they can depend on the chosen action or parameters specified for the game or state.</p>
</div>
<div id="a-game-with-2-states-and-transitions" class="section level2">
<h2 class="hasAnchor">
<a href="#a-game-with-2-states-and-transitions" class="anchor"></a>2. A game with 2 states and transitions</h2>
<p>Consider now the following game with two states:</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw">RelationalContracts</span>)
<span class="kw">effort.seq</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>,<span class="fl">1</span>,by=<span class="fl">0.1</span>)
<span class="kw">vul</span> <span class="op">=</span> <span class="fl">1</span>
<span class="kw">g</span> <span class="op">=</span> <span class="fu"><a href="../reference/rel_game.html">rel_game</a></span>() <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/rel_states.html">rel_state</a></span>(<span class="st">"not_vul"</span>,
    A1 = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(e1=<span class="kw">effort.seq</span>, make_vul = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">FALSE</span>, <span class="fl">TRUE</span>)),
    A2 = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(e2=<span class="kw">effort.seq</span>),
    pi1 = <span class="kw">e2</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">*</span><span class="kw">e1</span><span class="op">^</span><span class="fl">2</span>,
    pi2 = <span class="kw">e1</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">*</span><span class="kw">e2</span><span class="op">^</span><span class="fl">2</span>
  ) <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/rel_states.html">rel_state</a></span>(<span class="st">"vul"</span>,
    A1 = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(e1=<span class="kw">effort.seq</span>),
    A2 = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(e2=<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="kw">vul</span>,<span class="kw">effort.seq</span>)),
    pi1 = <span class="kw">e2</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">*</span><span class="kw">e1</span><span class="op">^</span><span class="fl">2</span>,
    pi2 = <span class="kw">e1</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmax</a></span>(<span class="kw">e2</span>,<span class="fl">0</span>)<span class="op">^</span><span class="fl">2</span>
  ) <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/rel_transition.html">rel_transition</a></span>(<span class="st">"not_vul"</span>,<span class="st">"vul"</span>, make_vul=<span class="fl">TRUE</span>,prob=<span class="fl">1</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/rel_transition.html">rel_transition</a></span>(<span class="st">"vul"</span>,<span class="st">"not_vul"</span>, prob = <span class="fl">0.05</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/rel_compile.html">rel_compile</a></span>()

<span class="co"># Solve SP</span>
<span class="co"># </span>
<span class="kw">g</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/rel_spe.html">rel_spe</a></span>(delta=<span class="fl">0.3</span>) <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/get_eq.html">get_eq</a></span>() <span class="op">%&gt;%</span> <span class="fu">select</span>(<span class="kw">x</span>, <span class="kw">ae.lab</span>)
</pre></div>
<pre><code>## # A tibble: 2 x 2
##   x       ae.lab     
##   &lt;chr&gt;   &lt;chr&gt;      
## 1 not_vul 0.6 1 | 0.6
## 2 vul     0.9 | 0.9</code></pre>
<p>We now have two states. The game starts in state “not_vul”. Here player 1 has a two dimensional actions space <code>A1</code>. In addition to choosing effort levels, player 1 can choose via <code>make_vul</code> whether to make herself vulnerable or not. In the state “vul”, player 2 can choose negative effort that harms player 1. We specify the state transitions via the function <code>rel_transition</code>.</p>
<p>The command <code><a href="../reference/rel_transition.html">rel_transition("not_vul","vul",make_vul=TRUE,prob=1)</a></code> means that there is a transition from state “not_vul” to state “vul” with probability <code>prob=1</code> if the action <code>make_vul=TRUE</code> was chosen. The effort levels do not affect this transition probability.</p>
<p>The line <code><a href="../reference/rel_transition.html">rel_transition("vul","not_vul", prob = 0.05)</a></code> means that there is a transition from state “vul” to state “not_vul” with probability of 5%, irrespective of which actions have been chosen.</p>
<p>For cases in which no explicit transition probability is specified it is assumed that play remains in the current state. I.e. if player 1 chooses <code>make_vul = FALSE</code> in stat “not_vul” the game remains in state “not_vul” even though we have not explicitly specified this.</p>
</div>
<div id="specifying-multiple-states-at-once" class="section level2">
<h2 class="hasAnchor">
<a href="#specifying-multiple-states-at-once" class="anchor"></a>3. Specifying Multiple States at Once</h2>
<p>Consider the following game specification that has 6 different states determined by increasing vulnerability of player 1:</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="kw">effort.seq</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>,<span class="fl">1</span>,by=<span class="fl">0.1</span>)
<span class="kw">g</span> <span class="op">=</span> <span class="fu"><a href="../reference/rel_game.html">rel_game</a></span>() <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/rel_states.html">rel_states</a></span>(x = <span class="fl">0</span><span class="op">:</span><span class="fl">5</span>,
    A1 = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(e1=<span class="kw">effort.seq</span>, inc_vul = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">FALSE</span>, <span class="fl">TRUE</span>)),
    A2 = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(e2=<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="fl">1</span>,<span class="kw">effort.seq</span>)),
    pi1 = <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="kw">e2</span> != <span class="op">-</span><span class="fl">1</span>,<span class="kw">e2</span>, <span class="op">-</span><span class="kw">x</span><span class="op">/</span><span class="fl">5</span>) <span class="op">-</span> <span class="fl">0.5</span><span class="op">*</span><span class="kw">e1</span><span class="op">^</span><span class="fl">2</span>,
    pi2 = <span class="kw">e1</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmax</a></span>(<span class="kw">e2</span>,<span class="fl">0</span>)<span class="op">^</span><span class="fl">2</span>
  ) <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/rel_transition.html">rel_transition</a></span>(xs = <span class="fl">0</span><span class="op">:</span><span class="fl">4</span>,xd=<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, inc_vul=<span class="fl">TRUE</span>,prob=<span class="fl">1</span>)
  

<span class="co"># Solve SPE</span>
<span class="kw">g</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/rel_spe.html">rel_spe</a></span>(delta=<span class="fl">0.3</span>) <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/get_eq.html">get_eq</a></span>() <span class="op">%&gt;%</span> <span class="fu">select</span>(<span class="kw">x</span>, <span class="kw">ae.lab</span>)
</pre></div>
<pre><code>## # A tibble: 6 x 2
##       x ae.lab     
##   &lt;int&gt; &lt;chr&gt;      
## 1     0 0.6 1 | 0.6
## 2     1 0.7 1 | 0.7
## 3     2 0.7 1 | 0.8
## 4     3 0.8 1 | 0.8
## 5     4 0.8 1 | 0.9
## 6     5 0.9 0 | 0.9</code></pre>
<p>The function <code>rel_states</code> is just a synonym for <code>rel_state</code> and can be used to specify several states simultaneously. A state <code>x</code> is here identified by an integer between 0 and 5 that relates to player 1’s vulnerability.</p>
<p>Note that the formula for <code>pi1</code> refers to the current state <code>x</code>.</p>
<p>The function <code>rel_transition</code> allows to specify multiple source states <code>xs</code> and multiple destination states <code>xd</code>. Here choosing <code>inc_vul=TRUE</code> increases the state number, as long as we have not reached yet state <code>x=5</code>.</p>
<p>The specification above specifies the same action space for all states, even though in state <code>x=5</code> the action <code>inc_vul</code> has no effect.</p>
<p>One way to specify different action spaces for different subsets of states is to add multiple <code>rel_states</code> commands as in the example below:</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="kw">effort.seq</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>,<span class="fl">1</span>,by=<span class="fl">0.1</span>)
<span class="kw">g</span> <span class="op">=</span> <span class="fu"><a href="../reference/rel_game.html">rel_game</a></span>() <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/rel_states.html">rel_states</a></span>(x = <span class="fl">0</span><span class="op">:</span><span class="fl">4</span>,
    A1 = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(e1=<span class="kw">effort.seq</span>, inc_vul = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">FALSE</span>, <span class="fl">TRUE</span>)),
    A2 = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(e2=<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="fl">1</span>,<span class="kw">effort.seq</span>)),
    pi1 =  <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="kw">e2</span> != <span class="op">-</span><span class="fl">1</span>,<span class="kw">e2</span>, <span class="op">-</span><span class="kw">x</span><span class="op">/</span><span class="fl">5</span>) <span class="op">-</span> <span class="fl">0.5</span><span class="op">*</span><span class="kw">e1</span><span class="op">^</span><span class="fl">2</span>,
    pi2 =  <span class="kw">e1</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmax</a></span>(<span class="kw">e2</span>,<span class="fl">0</span>)<span class="op">^</span><span class="fl">2</span>
  ) <span class="op">%&gt;%</span>
  <span class="co"># Specify state x=5 separately without inc_vul action</span>
  <span class="fu"><a href="../reference/rel_states.html">rel_states</a></span>(x = <span class="fl">5</span>,
    A1 = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(e1=<span class="kw">effort.seq</span>),
    A2 = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(e2=<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="fl">1</span>,<span class="kw">effort.seq</span>)),
    pi1 = <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="kw">e2</span> != <span class="op">-</span><span class="fl">1</span>,<span class="kw">e2</span>, <span class="op">-</span><span class="kw">x</span><span class="op">/</span><span class="fl">5</span>) <span class="op">-</span> <span class="fl">0.5</span><span class="op">*</span><span class="kw">e1</span><span class="op">^</span><span class="fl">2</span>,
    pi2 = <span class="kw">e1</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmax</a></span>(<span class="kw">e2</span>,<span class="fl">0</span>)<span class="op">^</span><span class="fl">2</span>
  ) <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/rel_transition.html">rel_transition</a></span>(xs = <span class="fl">0</span><span class="op">:</span><span class="fl">4</span>,xd=<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, inc_vul=<span class="fl">TRUE</span>,prob=<span class="fl">1</span>)
</pre></div>
</div>
<div id="specify-action-spaces-via-a-fun-instead-of-a1-and-a2" class="section level2">
<h2 class="hasAnchor">
<a href="#specify-action-spaces-via-a-fun-instead-of-a1-and-a2" class="anchor"></a>4. Specify action spaces via A.fun instead of A1 and A2</h2>
<p>If you want to specify several states with different action spaces in a single call to <code>rel_states</code> you should use the argument <code>A.fun</code> instead of <code>A1</code> and <code>A2</code>. Below is an example:</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="kw">effort.seq</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>,<span class="fl">1</span>,by=<span class="fl">0.1</span>)

<span class="co"># Function that specifies action spaces</span>
<span class="kw">A.fun</span> <span class="op">=</span> <span class="fu">function</span>(<span class="kw">x</span>,<span class="kw">...</span>) {
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
    A1 = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(e1=<span class="kw">effort.seq</span>, inc_vul = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">FALSE</span>, <span class="co">if</span> (<span class="kw">x</span><span class="op">&lt;</span><span class="fl">5</span>) <span class="fl">TRUE</span>)),
    A2 = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(e2=<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="co">if</span> (<span class="kw">x</span><span class="op">&gt;</span><span class="fl">0</span>) <span class="op">-</span><span class="fl">1</span>,<span class="kw">effort.seq</span>))
  )
}

<span class="kw">g</span> <span class="op">=</span> <span class="fu"><a href="../reference/rel_game.html">rel_game</a></span>() <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/rel_states.html">rel_states</a></span>(x = <span class="fl">0</span><span class="op">:</span><span class="fl">5</span>,
    A.fun = <span class="kw">A.fun</span>,
    pi1 = <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="kw">e2</span> != <span class="op">-</span><span class="fl">1</span>,<span class="kw">e2</span>, <span class="op">-</span><span class="kw">x</span><span class="op">/</span><span class="fl">5</span>) <span class="op">-</span> <span class="fl">0.5</span><span class="op">*</span><span class="kw">e1</span><span class="op">^</span><span class="fl">2</span>,
    pi2 = <span class="kw">e1</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmax</a></span>(<span class="kw">e2</span>,<span class="fl">0</span>)<span class="op">^</span><span class="fl">2</span>
  ) <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/rel_transition.html">rel_transition</a></span>(xs = <span class="fl">0</span><span class="op">:</span><span class="fl">4</span>,xd=<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, inc_vul=<span class="fl">TRUE</span>,prob=<span class="fl">1</span>)
  

<span class="co"># Solve SPE</span>
<span class="kw">g</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/rel_spe.html">rel_spe</a></span>(delta=<span class="fl">0.3</span>) <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/get_eq.html">get_eq</a></span>() <span class="op">%&gt;%</span> <span class="fu">select</span>(<span class="kw">x</span>, <span class="kw">ae.lab</span>)
</pre></div>
<pre><code>## # A tibble: 6 x 2
##       x ae.lab     
##   &lt;int&gt; &lt;chr&gt;      
## 1     0 0.6 1 | 0.6
## 2     1 0.7 1 | 0.7
## 3     2 0.7 1 | 0.8
## 4     3 0.8 1 | 0.8
## 5     4 0.8 1 | 0.9
## 6     5 0.9 0 | 0.9</code></pre>
<p>The function <code>A.fun</code> will be called separately for each state <code>x</code> and should return a list with elements <code>A1</code> and <code>A2</code> describing the action spaces of both players for the current state.</p>
</div>
<div id="specify-payoffs-via-pi-fun-instead-of-pi1-and-pi2" class="section level2">
<h2 class="hasAnchor">
<a href="#specify-payoffs-via-pi-fun-instead-of-pi1-and-pi2" class="anchor"></a>5. Specify payoffs via pi.fun instead of pi1 and pi2</h2>
<p>The argument <code>pi.fun</code> of <code>rel_states</code> allows to specify payoffs via a function instead of providing formulas to the arguments <code>pi1</code> and <code>pi2</code>. Here is an example:</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="kw">effort.seq</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>,<span class="fl">1</span>,by=<span class="fl">0.1</span>)
<span class="kw">pi.fun</span> <span class="op">=</span> <span class="fu">function</span>(<span class="kw">ax.df</span>, <span class="kw">...</span>) {
  <span class="fu">mutate</span>(<span class="kw">ax.df</span>,
    pi1 = <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="kw">e2</span> != <span class="op">-</span><span class="fl">1</span>,<span class="kw">e2</span>, <span class="op">-</span><span class="kw">x</span><span class="op">/</span><span class="fl">5</span>) <span class="op">-</span> <span class="fl">0.5</span><span class="op">*</span><span class="kw">e1</span><span class="op">^</span><span class="fl">2</span>,
    pi2 = <span class="kw">e1</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmax</a></span>(<span class="kw">e2</span>,<span class="fl">0</span>)<span class="op">^</span><span class="fl">2</span>
  )
}

<span class="kw">g</span> <span class="op">=</span> <span class="fu"><a href="../reference/rel_game.html">rel_game</a></span>() <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/rel_states.html">rel_states</a></span>(x = <span class="fl">0</span><span class="op">:</span><span class="fl">5</span>,
    A1 = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(e1=<span class="kw">effort.seq</span>, inc_vul = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">FALSE</span>, <span class="fl">TRUE</span>)),
    A2 = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(e2=<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="fl">1</span>,<span class="kw">effort.seq</span>)),
    pi.fun = <span class="kw">pi.fun</span>
  ) <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/rel_transition.html">rel_transition</a></span>(xs = <span class="fl">0</span><span class="op">:</span><span class="fl">4</span>,xd=<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, inc_vul=<span class="fl">TRUE</span>,prob=<span class="fl">1</span>)

<span class="co"># Solve SPE</span>
<span class="kw">g</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/rel_spe.html">rel_spe</a></span>(delta=<span class="fl">0.3</span>) <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/get_eq.html">get_eq</a></span>() <span class="op">%&gt;%</span> <span class="fu">select</span>(<span class="kw">x</span>, <span class="kw">ae.lab</span>)
</pre></div>
<pre><code>## # A tibble: 6 x 2
##       x ae.lab     
##   &lt;int&gt; &lt;chr&gt;      
## 1     0 0.6 1 | 0.6
## 2     1 0.7 1 | 0.7
## 3     2 0.7 1 | 0.8
## 4     3 0.8 1 | 0.8
## 5     4 0.8 1 | 0.9
## 6     5 0.9 0 | 0.9</code></pre>
<p>While <code>A.fun</code> will be called separately for each state <code>x</code>, the function <code>pi.fun</code> will be called only once with an argument <code>ax.df</code> (and possible some parameters specified in the game as explained in Section 11). <code>ax.df</code> is a tibble that contains one row for every action profile in every state. In our example, its head and tail looks as follows:</p>
<pre><code>head(ax.df,3)

# A tibble: 1,584 x 5
       x    .a    e1 inc_vul    e2
   &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;lgl&gt;   &lt;dbl&gt;
 1     0     1     0 FALSE    -1  
 2     0     2     0 FALSE     0  
 3     0     3     0 FALSE     0.1

tail(ax.df,3)

# A tibble: 3 x 5
      x    .a    e1 inc_vul    e2
  &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;lgl&gt;   &lt;dbl&gt;
1     5   262     1 TRUE      0.8
2     5   263     1 TRUE      0.9
3     5   264     1 TRUE      1</code></pre>
<p>The column <code>x</code> specifies a state, the column <code>.a</code> will probably not be used, it is just a unique index of the action profile number. The other columns correspond to the action names. (If some action is not present in some state, it is filled with <code>NA</code>)</p>
<p>Your function basically should add the columns <code>pi1</code> and <code>pi2</code> to each row of this data frame. You can drop some columns, but should keep <code>x</code> and not change the order of rows.</p>
</div>
<div id="specify-state-transitions-via-trans-fun" class="section level2">
<h2 class="hasAnchor">
<a href="#specify-state-transitions-via-trans-fun" class="anchor"></a>6. Specify state transitions via trans.fun</h2>
<p>As an alternative to specifying state transitions with one or several calls to <code>rel_transition</code>, one can use the argument <code>trans.fun</code> in the call to <code>rel_states</code>. Here is an example:</p>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="kw">trans.fun</span> <span class="op">=</span> <span class="fu">function</span>(<span class="kw">ax.df</span>, <span class="kw">...</span>) {
  <span class="fu">tibble</span>(xs=<span class="fl">0</span><span class="op">:</span><span class="fl">4</span>,xd=<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, inc_vul=<span class="fl">TRUE</span>, prob=<span class="fl">1</span>)
}
<span class="kw">g</span> <span class="op">=</span> <span class="fu"><a href="../reference/rel_game.html">rel_game</a></span>() <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/rel_states.html">rel_states</a></span>(x = <span class="fl">0</span><span class="op">:</span><span class="fl">5</span>,
    A1 = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(e1=<span class="kw">effort.seq</span>, inc_vul = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">FALSE</span>, <span class="fl">TRUE</span>)),
    A2 = <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(e2=<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="fl">1</span>,<span class="kw">effort.seq</span>)),
    pi1 =  <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="kw">e2</span> != <span class="op">-</span><span class="fl">1</span>,<span class="kw">e2</span>, <span class="op">-</span><span class="kw">x</span><span class="op">/</span><span class="fl">5</span>) <span class="op">-</span> <span class="fl">0.5</span><span class="op">*</span><span class="kw">e1</span><span class="op">^</span><span class="fl">2</span>,
    pi2 =  <span class="kw">e1</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmax</a></span>(<span class="kw">e2</span>,<span class="fl">0</span>)<span class="op">^</span><span class="fl">2</span>,
    trans.fun = <span class="kw">trans.fun</span>
  )
</pre></div>
<p><code>trans.fun</code> is a function that takes the same arguments as explained in the subsection about <code>pi.fun</code> above. It returns a data frame whose columns are essentially the same as the arguments of <code>rel_transition</code>. Each row specifies a transition from the state in column <code>xs</code> to the state in column <code>xd</code> with probability in column <code>prob</code> given that the actions take the values specified in additional columns.</p>
<p>You may add columns for all actions and set a value of <code>NA</code> if this action is not relevant in a particular row. So we could also have specified the state transitions as</p>
<div class="sourceCode" id="cb14"><pre class="downlit">
<span class="kw">trans.fun</span> <span class="op">=</span> <span class="fu">function</span>(<span class="kw">ax.df</span>, <span class="kw">...</span>) {
  <span class="fu">tibble</span>(xs=<span class="fl">0</span><span class="op">:</span><span class="fl">4</span>,xd=<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, inc_vul=<span class="fl">TRUE</span>,e1=<span class="fl">NA</span>, e2=<span class="fl">NA</span>, prob=<span class="fl">1</span>)
}
</pre></div>
<p>In the current example, there is little value of using the <code>trans.fun</code> argument instead of <code>rel_transition</code>. Yet, in more complex games with multidimensional state spaces and complex state transitions <code>trans.fun</code> can be more tractable. We will provide examples below.</p>
</div>
<div id="state-space-with-multiple-dimensions-and-helper-variables-a-cournot-duopoly-with-capacity-investments" class="section level2">
<h2 class="hasAnchor">
<a href="#state-space-with-multiple-dimensions-and-helper-variables-a-cournot-duopoly-with-capacity-investments" class="anchor"></a>7. State Space with multiple dimensions and helper variables: A Cournot Duopoly with Capacity Investments</h2>
<p>The following examples will be variants of a dynamic Cournot duopoly with capacity investments. A state <code>x</code> is characterized by a tuple <code>(x1,x2)</code> that describes the production capacities of each player. In each period players simultaneously choose integer outputs <code>q1</code> and <code>q2</code> between 0 and their capacity and decide whether or not to invest into new capacity. A player can invest until a maximum capacity <code>x.max</code> has been reached.</p>
<p>Product market prices in a period are given by <code>a-q1-q2</code> where <code>a</code> is an exogenous parameter.</p>
<p>The following code specifies such a Cournot duopoly:</p>
<div class="sourceCode" id="cb15"><pre class="downlit">
<span class="co"># Exogenous paramaters</span>
<span class="kw">x.max</span> <span class="op">=</span> <span class="fl">5</span>
<span class="kw">a</span> <span class="op">=</span> <span class="fl">8</span>
<span class="kw">i.cost</span> <span class="op">=</span> <span class="fl">1</span>

<span class="co"># State matrix</span>
<span class="kw">x.df</span> <span class="op">=</span> <span class="kw">tidyr</span>::<span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand_grid.html">expand_grid</a></span>(x1=<span class="fl">0</span><span class="op">:</span><span class="kw">x.max</span>, x2=<span class="fl">0</span><span class="op">:</span><span class="kw">x.max</span>) <span class="op">%&gt;%</span>
  <span class="fu">mutate</span>(x=<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="kw">x1</span>,<span class="st">"_"</span>,<span class="kw">x2</span>))

<span class="co"># Action space</span>
<span class="kw">A.fun</span> <span class="op">=</span> <span class="fu">function</span>(<span class="kw">x1</span>,<span class="kw">x2</span>,<span class="kw">...</span>) {
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
    A1=<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(q1 = <span class="fl">0</span><span class="op">:</span><span class="kw">x1</span>, i1=<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="co">if</span> (<span class="kw">x1</span> <span class="op">&lt;</span> <span class="kw">x.max</span>) <span class="fl">1</span>)),
    A2=<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(q2 = <span class="fl">0</span><span class="op">:</span><span class="kw">x2</span>, i2=<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="co">if</span> (<span class="kw">x2</span> <span class="op">&lt;</span> <span class="kw">x.max</span>) <span class="fl">1</span>))
  )
}

<span class="co"># State transitions</span>
<span class="kw">trans.fun</span> <span class="op">=</span> <span class="fu">function</span>(<span class="kw">ax.df</span>,<span class="kw">...</span>) {
  <span class="fu">restore.point</span>(<span class="st">"trans.fun"</span>)
  <span class="kw">ax.df</span> <span class="op">%&gt;%</span>
    <span class="fu">select</span>(<span class="kw">x</span>,<span class="kw">x1</span>,<span class="kw">x2</span>,<span class="kw">i1</span>,<span class="kw">i2</span>) <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>() <span class="op">%&gt;%</span>
    <span class="fu">mutate</span>(
      new_x1 = <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmin</a></span>(<span class="kw">x1</span><span class="op">+</span><span class="kw">i1</span>,<span class="kw">x.max</span>),
      new_x2 = <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmin</a></span>(<span class="kw">x2</span><span class="op">+</span><span class="kw">i2</span>,<span class="kw">x.max</span>),
      xd = <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="kw">new_x1</span>,<span class="st">"_"</span>,<span class="kw">new_x2</span>),
      xs=<span class="kw">x</span>,
      prob = <span class="fl">1</span>
    )
}

<span class="kw">g</span> <span class="op">=</span> <span class="fu"><a href="../reference/rel_game.html">rel_game</a></span>(<span class="st">"Cournot with Investment"</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/rel_states.html">rel_states</a></span>(x=<span class="kw">x.df</span>,
    A.fun=<span class="kw">A.fun</span>,
    pi1 = (<span class="kw">a</span><span class="op">-</span>(<span class="kw">q1</span><span class="op">+</span><span class="kw">q2</span>))<span class="op">*</span><span class="kw">q1</span> <span class="op">-</span> <span class="kw">i.cost</span><span class="op">*</span><span class="kw">i1</span>,
    pi2 = (<span class="kw">a</span><span class="op">-</span>(<span class="kw">q1</span><span class="op">+</span><span class="kw">q2</span>))<span class="op">*</span><span class="kw">q2</span> <span class="op">-</span> <span class="kw">i.cost</span><span class="op">*</span><span class="kw">i2</span>,
    trans.fun=<span class="kw">trans.fun</span>
  )

<span class="co"># g %&gt;% rel_spe(delta=0.3) %&gt;% get_eq() %&gt;% select(x, ae.lab,U)</span>
</pre></div>
<p>First note that in the call to <code>rel_states</code>, the argument <code>x</code> is not a vector of state names, but instead the data frame <code>x.df</code> specified further above. The data frame has the columns <code>x1</code> and <code>x2</code> that provide additional information about each state, namely the capacities of each player. The additional column <code>x</code> uniquely identifies each state as a label that just pastes <code>x1</code> and <code>x2</code> together.</p>
<p>The additional state variables <code>x1</code> and <code>x2</code>can be used in the formula’s for <code>pi1</code> and <code>pi2</code>, are passed as additional arguments to <code>A.fun</code>, and are additional columns in the <code>ax.df</code> argument passed to <code>trans.fun</code>. You can add as many columns to such a state data frame as you like. The only requirement is that there is a column <code>x</code> with unique values in each row.</p>
<p>The specification of <code>A.fun</code> is pretty straightforward. Note how the action space depends on the current capacity of each player.</p>
<p>More complex is the specification of state transitions in <code>trans.fun</code>. In general it is not easy to specify state transitions correctly on a first trial. I recommend to use <a href="https://cran.r-project.org/web/packages/restorepoint/vignettes/Guide_restorepoint.html">debugging via restore points</a> (or some other debugging approach) to build a correct <code>trans.fun</code>. Let me explain, step by step, what we have done.</p>
<p>We start with <code>ax.df</code> which contains one row for each action profile in each state. It looks as follows</p>
<pre><code>&gt; ax.df
# A tibble: 1,296 x 8
      x1    x2 x        .a    q1    i1    q2    i2
   &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;
 1     0     0 0_0       1     0     0     0     0
 2     0     0 0_0       2     0     0     0     1
 3     0     0 0_0       3     0     1     0     0
 4     0     0 0_0       4     0     1     0     1
 5     0     1 0_1       1     0     0     0     0
 6     0     1 0_1       2     0     0     1     0
 7     0     1 0_1       3     0     0     0     1
 8     0     1 0_1       4     0     0     1     1
 9     0     1 0_1       5     0     1     0     0
10     0     1 0_1       6     0     1     1     0
# ... with 1,285 more rows</code></pre>
<p>Relevant to compute state transitions are only the investment actions and the state variables. We thus select the relevant columns and reduce to unique rows. We get:</p>
<pre><code>ax.df %&gt;%
  select(x,x1,x2,i1,i2) %&gt;%
  unique()

# A tibble: 121 x 5
   x        x1    x2    i1    i2
   &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 0_0       0     0     0     0
 2 0_0       0     0     0     1
 3 0_0       0     0     1     0
 4 0_0       0     0     1     1
 5 0_1       0     1     0     0
 6 0_1       0     1     0     1
# ... with 115 more rows</code></pre>
<p>Starting with this data frame, we can easily compute the new capacities of both players by adding their investments to the current capacities. The new state <code>xd</code> is then simply created by pasting the new capacities together. We also have to add the transition probability of <code>prob=1</code> since state transitions are deterministic and set the source state column <code>xs</code> just to the original state <code>x</code>.</p>
</div>
<div id="specifying-state-transitions-using-the-helper-function-irv_joint_dist-cournot-duopoly-where-investments-are-not-always-successful" class="section level2">
<h2 class="hasAnchor">
<a href="#specifying-state-transitions-using-the-helper-function-irv_joint_dist-cournot-duopoly-where-investments-are-not-always-successful" class="anchor"></a>8. Specifying state transitions using the helper function <code>irv_joint_dist</code>: Cournot duopoly where investments are not always successful</h2>
<p>Consider now a variant of our previous game in which an investment leads to a successful capacity expansion only with an exogenous success probability <code>sp</code>.</p>
<p>Specifying state transitions becomes more complicated now. Assume both players invest, then there are 4 different possible outcomes: no investment is successful, only player 1’s investment is successful, only player 2’s investment is successful, or both investments are successful.</p>
<p>Relational Contracts has a helper function <code>irv_joint_dist</code> that allows to compute joint distributions of independent discrete random variables using a format suitable to specify state transitions. Consider the following example.</p>
<div class="sourceCode" id="cb18"><pre class="downlit">
<span class="co"># success probability of investment</span>
<span class="kw">sp</span> <span class="op">=</span> <span class="fl">0.7</span>

<span class="co"># An example row for which we want</span>
<span class="co"># to compute transition probabilities</span>
<span class="kw">df</span> <span class="op">=</span> <span class="fu">tibble</span>(x=<span class="st">"0_0"</span>,x1=<span class="fl">0</span>,x2=<span class="fl">0</span>,i1=<span class="fl">1</span>,i2=<span class="fl">1</span>)

<span class="co"># Compute joint distribution of independent</span>
<span class="co"># random varibles</span>
<span class="fu"><a href="../reference/irv_joint_dist.html">irv_joint_dist</a></span>(<span class="kw">df</span>,
  <span class="fu"><a href="../reference/irv.html">irv</a></span>(<span class="st">"new_x1"</span>,default=<span class="kw">x1</span>,
    <span class="fu"><a href="../reference/irv_val.html">irv_val</a></span>(val=<span class="kw">x1</span><span class="op">+</span><span class="fl">1</span>,prob=<span class="kw">i1</span><span class="op">*</span><span class="kw">sp</span>)
  ),
  <span class="fu"><a href="../reference/irv.html">irv</a></span>(<span class="st">"new_x2"</span>,default=<span class="kw">x2</span>,
    <span class="fu"><a href="../reference/irv_val.html">irv_val</a></span>(val=<span class="kw">x2</span><span class="op">+</span><span class="fl">1</span>,prob=<span class="kw">i2</span><span class="op">*</span><span class="kw">sp</span>)
  )
)
</pre></div>
<pre><code>## # A tibble: 4 x 8
##   x        x1    x2    i1    i2  prob new_x1 new_x2
##   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1 0_0       0     0     1     1 0.490      1      1
## 2 0_0       0     0     1     1 0.21       0      1
## 3 0_0       0     0     1     1 0.21       1      0
## 4 0_0       0     0     1     1 0.09       0      0</code></pre>
<p>Inside the call to <code>irv_joint_dist</code> we specify with <code>irv</code> two discrete valued random variables <code>new_x1</code> and <code>new_x2</code> that shall be independently distributed from each other. Inside <code>irv</code> we call <code>irv_val</code> to specify values that the variable can take and their realiziation probabilities. These values and probabilities are computed using the columns of the data frame <code>df</code> passed to <code>irv_joint_dist</code> using lazy evaluation.</p>
<p>For convenience, we can also set a default value for each random variables that is realized with probability 1 minus the sum of probabilities of all explicitly specified probabilities via <code>irv_val</code>. E.g. without default values, we could have equivalently specified <code>new_x1</code> by</p>
<div class="sourceCode" id="cb20"><pre class="downlit">
  <span class="fu"><a href="../reference/irv.html">irv</a></span>(<span class="st">"new_x1"</span>,
    <span class="fu"><a href="../reference/irv_val.html">irv_val</a></span>(val=<span class="kw">x1</span><span class="op">+</span><span class="fl">1</span>,prob=<span class="kw">i1</span><span class="op">*</span><span class="kw">sp</span>),
    <span class="fu"><a href="../reference/irv_val.html">irv_val</a></span>(val=<span class="kw">x1</span>, prob=<span class="fl">1</span><span class="op">-</span>(<span class="kw">i1</span><span class="op">*</span><span class="kw">sp</span>))
  )
</pre></div>
<p>For each row of the passed data frame <code>df</code>, <code>irv_joint_dist</code> creates several rows: one for each possible outcome combination of the specified independent random variables. Since <code>df</code> only has a single row and there are 4 combinations of <code>new_x1</code> and <code>new_x2</code>, we get a data frame with 4 rows. The column <code>prob</code> contains the probability of the particular outcome combination.</p>
<p>If <code>df</code> contains multiple rows, these computations will be performed separately for each row and the resulting rows are combined together. Consider this example where in one row player 1 invests and in the other not:</p>
<div class="sourceCode" id="cb21"><pre class="downlit">
<span class="co"># success probability of investment</span>
<span class="kw">sp</span> <span class="op">=</span> <span class="fl">0.7</span>

<span class="co"># Two example rows for which we want</span>
<span class="co"># to compute transition probabiluties</span>
<span class="kw">df</span> <span class="op">=</span> <span class="fu">tibble</span>(x=<span class="st">"0_0"</span>,x1=<span class="fl">0</span>,x2=<span class="fl">0</span>,i1=<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">1</span>),i2=<span class="fl">1</span>)
<span class="kw">df</span>
</pre></div>
<pre><code>## # A tibble: 2 x 5
##   x        x1    x2    i1    i2
##   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 0_0       0     0     0     1
## 2 0_0       0     0     1     1</code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit">
<span class="co"># Compute joint distribution of independent</span>
<span class="co"># random varibles</span>
<span class="fu"><a href="../reference/irv_joint_dist.html">irv_joint_dist</a></span>(<span class="kw">df</span>,
  <span class="fu"><a href="../reference/irv.html">irv</a></span>(<span class="st">"new_x1"</span>,default=<span class="kw">x1</span>,
    <span class="fu"><a href="../reference/irv_val.html">irv_val</a></span>(val=<span class="kw">x1</span><span class="op">+</span><span class="fl">1</span>,prob=<span class="kw">i1</span><span class="op">*</span><span class="kw">sp</span>)
  ),
  <span class="fu"><a href="../reference/irv.html">irv</a></span>(<span class="st">"new_x2"</span>,default=<span class="kw">x2</span>,
    <span class="fu"><a href="../reference/irv_val.html">irv_val</a></span>(val=<span class="kw">x2</span><span class="op">+</span><span class="fl">1</span>,prob=<span class="kw">i2</span><span class="op">*</span><span class="kw">sp</span>)
  )
)
</pre></div>
<pre><code>## # A tibble: 6 x 8
##   x        x1    x2    i1    i2  prob new_x1 new_x2
##   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1 0_0       0     0     1     1 0.490      1      1
## 2 0_0       0     0     0     1 0.7        0      1
## 3 0_0       0     0     1     1 0.21       0      1
## 4 0_0       0     0     1     1 0.21       1      0
## 5 0_0       0     0     0     1 0.3        0      0
## 6 0_0       0     0     1     1 0.09       0      0</code></pre>
<p>The result has now 2+4=6 rows. If player 1 does not invest (<code>i1==0</code>), the variable <code>new_x1</code> always is 0 and there are only two outcomes.</p>
<p>Note that the order of the resulting rows is not very intutive. Internally <code>irv_joint_dist</code> tries to use vectorization for fast computation that sorts the rows in a peculiar way and for time reasons there is no unneccessary rearrangement afterwards.</p>
<p>Below is a specification of the transition function for our Cournot game using <code>irv_joint_dist</code>:</p>
<div class="sourceCode" id="cb25"><pre class="downlit">
<span class="kw">sp</span> <span class="op">=</span> <span class="fl">0.7</span>
<span class="kw">trans.fun</span> <span class="op">=</span> <span class="fu">function</span>(<span class="kw">ax.df</span>,<span class="kw">...</span>) {
  <span class="fu">restore.point</span>(<span class="st">"trans.fun"</span>)
  <span class="kw">ax.df</span> <span class="op">%&gt;%</span>
    <span class="fu">select</span>(<span class="kw">x</span>,<span class="kw">x1</span>,<span class="kw">x2</span>,<span class="kw">i1</span>,<span class="kw">i2</span>) <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>() <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/irv_joint_dist.html">irv_joint_dist</a></span>(<span class="kw">df</span>,
      <span class="fu"><a href="../reference/irv.html">irv</a></span>(<span class="st">"new_x1"</span>,default=<span class="kw">x1</span>,
        <span class="fu"><a href="../reference/irv_val.html">irv_val</a></span>(val=<span class="kw">x1</span><span class="op">+</span><span class="fl">1</span>,prob=<span class="kw">i1</span><span class="op">*</span><span class="kw">sp</span>)
      ),
      <span class="fu"><a href="../reference/irv.html">irv</a></span>(<span class="st">"new_x2"</span>,default=<span class="kw">x2</span>,
        <span class="fu"><a href="../reference/irv_val.html">irv_val</a></span>(val=<span class="kw">x2</span><span class="op">+</span><span class="fl">1</span>,prob=<span class="kw">i2</span><span class="op">*</span><span class="kw">sp</span>)
      )
    ) <span class="op">%&gt;%</span>    
    <span class="fu">mutate</span>(
      xd = <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="kw">new_x1</span>,<span class="st">"_"</span>,<span class="kw">new_x2</span>),
      xs=<span class="kw">x</span>
    )
}
</pre></div>
<p>This code may look complicated, but specifying transition probabilities correctly is typically the most difficult task in a game specificiation. And while it requires some time to learn, in my experience, <code>irv_joint_dist</code> is often quite a useful tool for this task.</p>
</div>
<div id="advanced-use-of-irv_joint_dist-cournot-duopoly-where-investments-are-not-always-successful-and-capacity-may-depreciate" class="section level2">
<h2 class="hasAnchor">
<a href="#advanced-use-of-irv_joint_dist-cournot-duopoly-where-investments-are-not-always-successful-and-capacity-may-depreciate" class="anchor"></a>9. Advanced use of <code>irv_joint_dist</code>: Cournot duopoly where investments are not always successful and capacity may depreciate</h2>
<p>Consider now a variant in which existing capacity can also depricate with positive depreciation probability <code>dp</code>.</p>
<p>The following code specifies the transition function:</p>
<div class="sourceCode" id="cb26"><pre class="downlit">
<span class="kw">trans.fun</span> <span class="op">=</span> <span class="fu">function</span>(<span class="kw">ax.df</span>,<span class="kw">...</span>) {
  <span class="fu">restore.point</span>(<span class="st">"trans.fun"</span>)
  <span class="kw">ax.df</span> <span class="op">%&gt;%</span>
    <span class="fu">select</span>(<span class="kw">x</span>,<span class="kw">x1</span>,<span class="kw">x2</span>,<span class="kw">i1</span>,<span class="kw">i2</span>) <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>() <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/irv_joint_dist.html">irv_joint_dist</a></span>(
      <span class="fu"><a href="../reference/irv.html">irv</a></span>(<span class="st">"add_x1"</span>,default=<span class="fl">0</span>,
        <span class="fu"><a href="../reference/irv_val.html">irv_val</a></span>(<span class="fl">1</span>,prob=<span class="kw">i1</span><span class="op">*</span><span class="kw">sp</span>)
      ),
      <span class="fu"><a href="../reference/irv.html">irv</a></span>(<span class="st">"add_x2"</span>,default=<span class="fl">0</span>,
        <span class="fu"><a href="../reference/irv_val.html">irv_val</a></span>(<span class="fl">1</span>,prob=<span class="kw">i2</span><span class="op">*</span><span class="kw">sp</span>)
      ),
      <span class="fu"><a href="../reference/irv.html">irv</a></span>(<span class="st">"rem_x1"</span>,default=<span class="fl">0</span>,
        <span class="fu"><a href="../reference/irv_val.html">irv_val</a></span>(<span class="fl">1</span>,prob=(<span class="kw">x1</span><span class="op">&gt;</span><span class="fl">0</span>)<span class="op">*</span><span class="kw">dp</span>)
      ),
      <span class="fu"><a href="../reference/irv.html">irv</a></span>(<span class="st">"rem_x2"</span>,default=<span class="fl">0</span>,
        <span class="fu"><a href="../reference/irv_val.html">irv_val</a></span>(<span class="fl">1</span>,prob=(<span class="kw">x2</span><span class="op">&gt;</span><span class="fl">0</span>)<span class="op">*</span><span class="kw">dp</span>)
      )
    ) <span class="op">%&gt;%</span>
    <span class="fu">mutate</span>(
      new_x1 = <span class="kw">x1</span><span class="op">+</span><span class="kw">add_x1</span> <span class="op">-</span> <span class="kw">rem_x1</span>,
      new_x2 = <span class="kw">x2</span><span class="op">+</span><span class="kw">add_x2</span> <span class="op">-</span> <span class="kw">rem_x2</span>,
      xd = <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="kw">new_x1</span>,<span class="st">"_"</span>,<span class="kw">new_x2</span>),
      xs=<span class="kw">x</span>
    ) <span class="op">%&gt;%</span>
    <span class="fu">group_by</span>(<span class="kw">xs</span>,<span class="kw">xd</span>,<span class="kw">i1</span>,<span class="kw">i2</span>) <span class="op">%&gt;%</span>
    <span class="fu">summarize</span>(prob=<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw">prob</span>))
}
</pre></div>
<p>We now specify 4 independent random variables. Each new capacity now depends on two random variables describing whether or nor investment successful and whether or not there is depreciation.</p>
<p>To understand why the final <code>group_by</code> and <code>summarize</code> is neccessary let us take a look at the computation before for a single intial row:</p>
<div class="sourceCode" id="cb27"><pre class="downlit">
<span class="kw">sp</span> <span class="op">=</span> <span class="fl">0.7</span>
<span class="kw">dp</span> <span class="op">=</span> <span class="fl">0.1</span>

<span class="fu">tibble</span>(x=<span class="st">"1_0"</span>,x1=<span class="fl">1</span>,x2=<span class="fl">0</span>,i1=<span class="fl">1</span>,i2=<span class="fl">0</span>) <span class="op">%&gt;%</span>
  <span class="fu">select</span>(<span class="kw">x</span>,<span class="kw">x1</span>,<span class="kw">x2</span>,<span class="kw">i1</span>,<span class="kw">i2</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>() <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/irv_joint_dist.html">irv_joint_dist</a></span>(
    <span class="fu"><a href="../reference/irv.html">irv</a></span>(<span class="st">"add_x1"</span>,default=<span class="fl">0</span>,
      <span class="fu"><a href="../reference/irv_val.html">irv_val</a></span>(<span class="fl">1</span>,prob=<span class="kw">i1</span><span class="op">*</span><span class="kw">sp</span>)
    ),
    <span class="fu"><a href="../reference/irv.html">irv</a></span>(<span class="st">"add_x2"</span>,default=<span class="fl">0</span>,
      <span class="fu"><a href="../reference/irv_val.html">irv_val</a></span>(<span class="fl">1</span>,prob=<span class="kw">i2</span><span class="op">*</span><span class="kw">sp</span>)
    ),
    <span class="fu"><a href="../reference/irv.html">irv</a></span>(<span class="st">"rem_x1"</span>,default=<span class="fl">0</span>,
      <span class="fu"><a href="../reference/irv_val.html">irv_val</a></span>(<span class="fl">1</span>,prob=(<span class="kw">x1</span><span class="op">&gt;</span><span class="fl">0</span>)<span class="op">*</span><span class="kw">dp</span>)
    ),
    <span class="fu"><a href="../reference/irv.html">irv</a></span>(<span class="st">"rem_x2"</span>,default=<span class="fl">0</span>,
      <span class="fu"><a href="../reference/irv_val.html">irv_val</a></span>(<span class="fl">1</span>,prob=(<span class="kw">x2</span><span class="op">&gt;</span><span class="fl">0</span>)<span class="op">*</span><span class="kw">dp</span>)
    )
  ) <span class="op">%&gt;%</span>
  <span class="fu">mutate</span>(
    new_x1 = <span class="kw">x1</span><span class="op">+</span><span class="kw">add_x1</span> <span class="op">-</span> <span class="kw">rem_x1</span>,
    new_x2 = <span class="kw">x2</span><span class="op">+</span><span class="kw">add_x2</span> <span class="op">-</span> <span class="kw">rem_x2</span>,
    xd = <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="kw">new_x1</span>,<span class="st">"_"</span>,<span class="kw">new_x2</span>),
    xs=<span class="kw">x</span>
  ) <span class="op">%&gt;%</span>
  <span class="fu">select</span>(<span class="kw">xs</span>,<span class="kw">xd</span>,<span class="kw">i1</span>,<span class="kw">i2</span>,<span class="kw">prob</span>,<span class="kw">add_x1</span>,<span class="kw">rem_x1</span>)
</pre></div>
<pre><code>## # A tibble: 4 x 7
##   xs    xd       i1    i2   prob add_x1 rem_x1
##   &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1 1_0   1_0       1     0 0.0700      1      1
## 2 1_0   0_0       1     0 0.03        0      1
## 3 1_0   2_0       1     0 0.63        1      0
## 4 1_0   1_0       1     0 0.27        0      0</code></pre>
<p>We see that both the first and last row transist to the same state. In the first row both investment and depreciation for player 1 happens, and in the last row neither one happens. Both yield the same net result: no change of capacity. The final <code>group_by</code> and <code>summarize</code> command inside <code>trans.fun</code> add up the probabilities of such rows with the same outcomes.</p>
</div>
<div id="separating-static-and-dynamic-actions" class="section level2">
<h2 class="hasAnchor">
<a href="#separating-static-and-dynamic-actions" class="anchor"></a>10. Separating static and dynamic actions</h2>
<p>Consider the following variant of the dynamic Cournot duopoly, where we have splitted the “static” actions <code>q1</code> and <code>q2</code> which don’t affect the state transitions from the “dynamic” actions <code>i1</code> and <code>i2</code>:</p>
<div class="sourceCode" id="cb29"><pre class="downlit">
<span class="kw">x.max</span> <span class="op">=</span> <span class="fl">5</span>
<span class="co"># State matrix</span>
<span class="kw">x.df</span> <span class="op">=</span> <span class="kw">tidyr</span>::<span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand_grid.html">expand_grid</a></span>(x1=<span class="fl">0</span><span class="op">:</span><span class="kw">x.max</span>, x2=<span class="fl">0</span><span class="op">:</span><span class="kw">x.max</span>) <span class="op">%&gt;%</span>
  <span class="fu">mutate</span>(x=<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="kw">x1</span>,<span class="st">"_"</span>,<span class="kw">x2</span>))

<span class="co"># static action space</span>
<span class="kw">static.A.fun</span> <span class="op">=</span> <span class="fu">function</span>(<span class="kw">x1</span>,<span class="kw">x2</span>,<span class="kw">...</span>) {
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
    A1=<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(q1 = <span class="fl">0</span><span class="op">:</span><span class="kw">x1</span>),
    A2=<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(q2 = <span class="fl">0</span><span class="op">:</span><span class="kw">x2</span>)
  )
}

<span class="co"># dynamic action space </span>
<span class="kw">A.fun</span> <span class="op">=</span> <span class="fu">function</span>(<span class="kw">x1</span>,<span class="kw">x2</span>,<span class="kw">x.max</span>,<span class="kw">...</span>) {
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
    A1=<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(i1=<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="co">if</span> (<span class="kw">x1</span> <span class="op">&lt;</span> <span class="kw">x.max</span>) <span class="fl">1</span>)),
    A2=<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(i2=<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="co">if</span> (<span class="kw">x2</span> <span class="op">&lt;</span> <span class="kw">x.max</span>) <span class="fl">1</span>))
  )
}

<span class="co"># State transitions: deterministic investments</span>
<span class="kw">trans.fun</span> <span class="op">=</span> <span class="fu">function</span>(<span class="kw">ax.df</span>,<span class="kw">x.max</span>,<span class="kw">...</span>) {
  <span class="fu">restore.point</span>(<span class="st">"trans.fun"</span>)
  <span class="kw">ax.df</span> <span class="op">%&gt;%</span>
    <span class="fu">select</span>(<span class="kw">x</span>,<span class="kw">x1</span>,<span class="kw">x2</span>,<span class="kw">i1</span>,<span class="kw">i2</span>) <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>() <span class="op">%&gt;%</span>
    <span class="fu">mutate</span>(
      new_x1 = <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmin</a></span>(<span class="kw">x1</span><span class="op">+</span><span class="kw">i1</span>,<span class="kw">x.max</span>),
      new_x2 = <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmin</a></span>(<span class="kw">x2</span><span class="op">+</span><span class="kw">i2</span>,<span class="kw">x.max</span>),
      xd = <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="kw">new_x1</span>,<span class="st">"_"</span>,<span class="kw">new_x2</span>),
      xs=<span class="kw">x</span>,
      prob = <span class="fl">1</span>
    )
}

<span class="kw">g</span> <span class="op">=</span> <span class="fu"><a href="../reference/rel_game.html">rel_game</a></span>(<span class="st">"Cournot with Investment"</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/rel_param.html">rel_param</a></span>(a = <span class="fl">10</span>,i.cost = <span class="fl">1.5</span>,x.max=<span class="kw">x.max</span>) <span class="op">%&gt;%</span>  
  <span class="fu"><a href="../reference/rel_states.html">rel_states</a></span>(x=<span class="kw">x.df</span>,
    A.fun=<span class="kw">A.fun</span>,
    static.A.fun = <span class="kw">static.A.fun</span>,
    static.pi1 = (<span class="kw">a</span><span class="op">-</span>(<span class="kw">q1</span><span class="op">+</span><span class="kw">q2</span>))<span class="op">*</span><span class="kw">q1</span>,
    static.pi2 = (<span class="kw">a</span><span class="op">-</span>(<span class="kw">q1</span><span class="op">+</span><span class="kw">q2</span>))<span class="op">*</span><span class="kw">q2</span>,
    pi1 = <span class="op">-</span> <span class="kw">i.cost</span><span class="op">*</span><span class="kw">i1</span>,
    pi2 = <span class="op">-</span> <span class="kw">i.cost</span><span class="op">*</span><span class="kw">i2</span>,
    trans.fun=<span class="kw">trans.fun</span>
  )

<span class="kw">g</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/rel_spe.html">rel_spe</a></span>(delta=<span class="fl">0.3</span>) <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/get_eq.html">get_eq</a></span>() <span class="op">%&gt;%</span> <span class="fu">select</span>(<span class="kw">x</span>, <span class="kw">ae.lab</span>,<span class="kw">U</span>)
</pre></div>
<pre><code>##      x        ae.lab      U
## 1  0_0 0 | 0 | 1 | 1  2.835
## 2  0_1 0 | 1 | 1 | 1 10.500
## 3  0_2 0 | 2 | 1 | 0 16.450
## 4  0_3 0 | 3 | 1 | 0 20.850
## 5  0_4 0 | 4 | 0 | 0 24.000
## 6  0_5 0 | 5 | 0 | 0 25.000
## 7  1_0 1 | 0 | 1 | 1 10.500
## 8  1_1 1 | 1 | 0 | 1 16.450
## 9  1_2 1 | 2 | 0 | 0 21.000
## 10 1_3 1 | 3 | 0 | 0 24.000
## 11 1_4 1 | 4 | 0 | 0 25.000
## 12 1_5 1 | 4 | 0 | 0 25.000
## 13 2_0 2 | 0 | 0 | 1 16.450
## 14 2_1 2 | 1 | 0 | 0 21.000
## 15 2_2 2 | 2 | 0 | 0 24.000
## 16 2_3 2 | 3 | 0 | 0 25.000
## 17 2_4 2 | 3 | 0 | 0 25.000
## 18 2_5 2 | 3 | 0 | 0 25.000
## 19 3_0 3 | 0 | 0 | 1 20.850
## 20 3_1 3 | 1 | 0 | 0 24.000
## 21 3_2 3 | 2 | 0 | 0 25.000
## 22 3_3 2 | 3 | 0 | 0 25.000
## 23 3_4 3 | 2 | 0 | 0 25.000
## 24 3_5 3 | 2 | 0 | 0 25.000
## 25 4_0 4 | 0 | 0 | 0 24.000
## 26 4_1 4 | 1 | 0 | 0 25.000
## 27 4_2 3 | 2 | 0 | 0 25.000
## 28 4_3 2 | 3 | 0 | 0 25.000
## 29 4_4 2 | 3 | 0 | 0 25.000
## 30 4_5 2 | 3 | 0 | 0 25.000
## 31 5_0 5 | 0 | 0 | 0 25.000
## 32 5_1 4 | 1 | 0 | 0 25.000
## 33 5_2 3 | 2 | 0 | 0 25.000
## 34 5_3 2 | 3 | 0 | 0 25.000
## 35 5_4 2 | 3 | 0 | 0 25.000
## 36 5_5 2 | 3 | 0 | 0 25.000</code></pre>
<p>If we specify static actions via <code>static.A.fun</code>, or<code>static.A1</code> and <code>static.A2</code> it means that each period consists of two stages in which actions can be chosen (each preceded by a stage in which transfers can be performed). First, the static actions are chosen and then the dynamic actions. Splitting up actions in this fashion can substantially reduce numerical complexity in form of memory requirements and run time of the solution algorithms.</p>
<p>Note that we have also have specified here the parameters <code>x.max</code>, <code>i.cost</code> and <code>a</code> via the function <code>rel_param</code>. All the specified parameters will be passed to the different functions like <code>trans.fun</code> that specify the game and can be used in expressions like <code>pi1</code> that will be lazily evaluated.</p>
</div>
<div id="make-players-move-in-turns" class="section level2">
<h2 class="hasAnchor">
<a href="#make-players-move-in-turns" class="anchor"></a>11. Make players move in turns</h2>
<p>There are some advantages to specify the game such that each period only a randomly selected player is able to make investment. For example, with simultaneous investment choices sometimes no pure strategy equilibria may exist. See the 2nd vignette how to implement and analyse such games with staggered moves.</p>
</div>
<div id="specifying-parameters-inside-the-game" class="section level2">
<h2 class="hasAnchor">
<a href="#specifying-parameters-inside-the-game" class="anchor"></a>12. Specifying parameters inside the game</h2>
<p>So far we have specified the parameters <code>x.max</code>, <code>i.cost</code> and <code>a</code> as global variables. Alternatively, you could also specify them in the game using the function <code>rel_param</code>. Consider the following variant:</p>
<div class="sourceCode" id="cb31"><pre class="downlit">
<span class="co"># Action space</span>
<span class="kw">A.fun</span> <span class="op">=</span> <span class="fu">function</span>(<span class="kw">x1</span>,<span class="kw">x2</span>,<span class="kw">x.max</span>,<span class="kw">...</span>) {
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
    A1=<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(q1 = <span class="fl">0</span><span class="op">:</span><span class="kw">x1</span>, i1=<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="co">if</span> (<span class="kw">x1</span> <span class="op">&lt;</span> <span class="kw">x.max</span>) <span class="fl">1</span>)),
    A2=<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(q2 = <span class="fl">0</span><span class="op">:</span><span class="kw">x2</span>, i2=<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="co">if</span> (<span class="kw">x2</span> <span class="op">&lt;</span> <span class="kw">x.max</span>) <span class="fl">1</span>))
  )
}

<span class="co"># State transitions</span>
<span class="kw">trans.fun</span> <span class="op">=</span> <span class="fu">function</span>(<span class="kw">ax.df</span>,<span class="kw">x.max</span>,<span class="kw">...</span>) {
  <span class="fu">restore.point</span>(<span class="st">"trans.fun"</span>)
  <span class="kw">ax.df</span> <span class="op">%&gt;%</span>
    <span class="fu">select</span>(<span class="kw">x</span>,<span class="kw">x1</span>,<span class="kw">x2</span>,<span class="kw">i1</span>,<span class="kw">i2</span>) <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>() <span class="op">%&gt;%</span>
    <span class="fu">mutate</span>(
      new_x1 = <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmin</a></span>(<span class="kw">x1</span><span class="op">+</span><span class="kw">i1</span>,<span class="kw">x.max</span>),
      new_x2 = <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmin</a></span>(<span class="kw">x2</span><span class="op">+</span><span class="kw">i2</span>,<span class="kw">x.max</span>),
      xd = <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="kw">new_x1</span>,<span class="st">"_"</span>,<span class="kw">new_x2</span>),
      xs=<span class="kw">x</span>,
      prob = <span class="fl">1</span>
    )
}

<span class="co"># State matrix</span>
<span class="kw">x.max</span> <span class="op">=</span> <span class="fl">5</span>
<span class="kw">x.df</span> <span class="op">=</span> <span class="kw">tidyr</span>::<span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand_grid.html">expand_grid</a></span>(x1=<span class="fl">0</span><span class="op">:</span><span class="kw">x.max</span>, x2=<span class="fl">0</span><span class="op">:</span><span class="kw">x.max</span>) <span class="op">%&gt;%</span>
  <span class="fu">mutate</span>(x=<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="kw">x1</span>,<span class="st">"_"</span>,<span class="kw">x2</span>))

<span class="kw">g</span> <span class="op">=</span> <span class="fu"><a href="../reference/rel_game.html">rel_game</a></span>(<span class="st">"Cournot with Investment"</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/rel_param.html">rel_param</a></span>(a = <span class="fl">10</span>,i.cost = <span class="fl">1.5</span>,x.max=<span class="kw">x.max</span>) <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/rel_states.html">rel_states</a></span>(x=<span class="kw">x.df</span>,
    A.fun=<span class="kw">A.fun</span>,
    pi1 = (<span class="kw">a</span><span class="op">-</span>(<span class="kw">q1</span><span class="op">+</span><span class="kw">q2</span>))<span class="op">*</span><span class="kw">q1</span> <span class="op">-</span> <span class="kw">i.cost</span><span class="op">*</span><span class="kw">i1</span>,
    pi2 = (<span class="kw">a</span><span class="op">-</span>(<span class="kw">q1</span><span class="op">+</span><span class="kw">q2</span>))<span class="op">*</span><span class="kw">q2</span> <span class="op">-</span> <span class="kw">i.cost</span><span class="op">*</span><span class="kw">i2</span>,
    trans.fun=<span class="kw">trans.fun</span>
  )

<span class="kw">g</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/rel_spe.html">rel_spe</a></span>(delta=<span class="fl">0.3</span>) <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/get_eq.html">get_eq</a></span>() <span class="op">%&gt;%</span> <span class="fu">select</span>(<span class="kw">x</span>, <span class="kw">ae.lab</span>,<span class="kw">U</span>)
</pre></div>
<pre><code>## # A tibble: 36 x 3
##    x     ae.lab        U
##    &lt;chr&gt; &lt;chr&gt;     &lt;dbl&gt;
##  1 0_0   0 1 | 0 1  2.84
##  2 0_1   0 1 | 1 1 10.5 
##  3 0_2   0 1 | 2 0 16.4 
##  4 0_3   0 1 | 3 0 20.8 
##  5 0_4   0 0 | 4 0 24.0 
##  6 0_5   0 0 | 5 0 25   
##  7 1_0   1 1 | 0 1 10.5 
##  8 1_1   1 0 | 1 1 16.4 
##  9 1_2   1 0 | 2 0 21   
## 10 1_3   1 0 | 3 0 24.0 
## # ... with 26 more rows</code></pre>
<p>The specified parameters will then be passed as additional arguments to <code>A.fun</code>, <code>trans.fun</code> etc and will also be used when <code>pi1</code> and <code>pi2</code> are evaluated.</p>
<p>If you want to create at the same time several game obects with different parameters, it seems advisable to store parameters inside the game and not rely on global variables. Otherwise it is a matter of taste, which style you want to use.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Sebastian Kranz.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
